{% extends 'supplies/base_for_home.html' %}
{% load myapp_extras %}
{% load mathfilters %}
{% block title %}
{{ title }}
{% endblock %}

{% block content %}
    <div class="container py-1">
    <form method="POST" action="" style="display: inline;" onsubmit="window.mytest()">
  {% csrf_token %}
<h3>
    <input type="hidden" name="next" value="{{ request.GET.next }}">
         <small class="text-muted">Для: {{order.place.name}}, {{order.place.city_ref.name}}</small>{% if not order.isComplete and request.user.is_staff %} <button class="btn btn-outline-danger mx-2" type="submit" name="delete"><i class="bi bi-trash"></i></button>{% endif %}
</h3>
    </form>
{% if order.comment %}
<h4>
  <small class="text-muted">Комментарій: {{order.comment}}</small>
</h4>
{% endif %}
    {% if order.for_agreement %}
<h4>
    <a href="{% url 'agreementDetail' order.for_agreement.id %}?next={{ request.get_full_path }}">Договір: № {{order.for_agreement.description}}</a>
</h4>
{% endif %}
    {% if order.for_preorder %}
<h5>
    <a href="{% url 'preorderDetail' order.for_preorder.id %}?next={{ request.get_full_path }}">Передзамовлення: № {{order.for_preorder.id}}</a>
</h5>
        {% if order.for_preorder.comment %}
        <h6>
        {{ order.for_preorder.comment }}
        </h6>
            {% endif %}
{% endif %}

<h5>
  <small class="text-muted">Cтворив: {{order.userCreated.last_name}}</small>
</h5>
{% if order.isComplete %}
        <p class="mb-2"><span>Статус:</span> <span class="complete">Відправлено</span> <span>{{order.dateSent|date:"d.m.Y" }}</span></p>
        {% else %}
        <p class="mb-2"><span>Статус:</span> <span class="waiting">В очікуванні</span></p>
        {%  endif %}

    {% if order.statusnpparselfromdoucmentid_set.exists %}
        <div class="container bg-light border shadow-sm p-3 mb-5 bg-body rounded justify-content-between">
        <h5>Нова пошта інфо: </h5>
        {% for document in order.statusnpparselfromdoucmentid_set.all %}
            <h6><u>Накладна № {{ document.docNumber }}</u>

                {% if request.user|has_group:"empl" or request.user.is_staff %}
                    {% if document.status_code == '1' %}
                         <button data-product="{{ document.id }}" data-action="delete" class="btn btn-sm mx-4 btn-danger add-btn delete-npdocument-button"><i class="bi bi-trash"></i></button>
                        {% endif %}
            {% endif %}
            </h6>
            <p class="mb-2"><span>Статус НП:</span> <b style="color: {% if document.status_code == '9' %} green {% elif document.status_code == '2' %} red {% else %} orange {% endif %}">{{ document.status_desc }}</b>  </p>
            <li><u style="font-style: italic">Відправник:</u> {{ document.warehouseSender }}</li>
            <li><u style="font-style: italic">Отримувач:</u> {{ document.counterpartyRecipientDescription }}, {{ document.recipientAddress }}, {{ document.recipientFullNameEW }}</li>
            <li><u style="font-style: italic">Тел.:</u> {{ document.phoneRecipient }} </li>
            <li><u style="font-style: italic">Очікувана дата доставки:</u> {{ document.scheduledDeliveryDate }} </li>
            <li><u style="font-style: italic">Дата прибуття:</u> {{ document.actualDeliveryDate }} </li>
            <li><u style="font-style: italic">Дата видачі:</u> {{ document.recipientDateTime }} </li>

            <li><u style="font-style: italic">Об'ємна вага:</u> {{ document.documentWeight }}</li>
            <li><u style="font-style: italic">Фактична вага:</u> {{ document.factualWeight }}</li>
            <li><u style="font-style: italic">Платник доставки:</u> {{ document.payerType }}</li>
            <li><u style="font-style: italic">Оплата:</u> {{ document.paymentMethod }}</li>
            <li><u style="font-style: italic">Кількість місць:</u> {{ document.seatsAmount }}</li>
            <li><u style="font-style: italic">Вартість доставки:</u> {{ document.documentCost }} грн.</li>
            <li><u style="font-style: italic">Оціночна вартість:</u> {{ document.announcedPrice }} грн.</li>
            <li><u style="font-style: italic">Опис:</u> {{ document.cargoDescriptionString }}</li>

        {% endfor %}
    </div>
    {% endif %}


{#        <a href="{% url 'orderDetailPdf' order.id %}">PDF</a>#}
    <div class="d-flex justify-content-between">
         <a href="{% url 'orderDetailCsv' order.id %}">Export to Excel</a>
        {% if not order.isComplete %}
            <a style="color: #ff8000" href="{% url 'convert_order_to_booked_order' order.id %}">Конвертувати замовлення в бронювання</a>
        {% endif %}
    </div>
</div>

    <table class="table centred mt-3 w-auto mx-auto">
  <thead class="thead-dark">
    <tr>
      <th scope="col" class="textAlignLeft" style="min-width: 400px">({{supplies|length}}) Назва товару</th>
      <th scope="col">Пакування / Тести</th>
        <th scope="col">Категорія</th>
        <th scope="col">REF</th>
        <th scope="col">SMN</th>
        <th scope="col">LOT</th>
        <th scope="col">Кількість</th>
        <th scope="col">Термін*</th>
      {% if request.user|has_group:"empl" or request.user.is_staff %}
          <th scope="col">Оновлено**</th>
    {% endif %}
        {% if not order.isComplete and request.user.is_staff %}
        <th scope="col">Action</th>
         {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for el in supplies %}
        {% include 'partials/orderDetail_cell_item.html' %}
   {% endfor %}
  </tbody>
</table>
    <div class="container d-flex flex-row-reverse">
    <div class="fst-italic" style="font-size: small">* - термін зазначено відносно дати відправки цього замовлення</div>
    </div>
        <div class="container d-flex flex-row-reverse">
    {% if request.user|has_group:"empl" or request.user.is_staff %}
          <div class="fst-italic" style="font-size: small">** - дата додавання цього товару в базу</div>
    {% endif %}
    </div>

<script type="text/javascript">window.mytest = function() { var isValid = confirm('Ви хочете видалити це замовлення ?');if (!isValid) { event.preventDefault();  alert("It wont delete. Yay!");}}</script>

{% endblock %}


