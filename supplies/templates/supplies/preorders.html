{% extends 'supplies/base.html' %}
{% load myapp_extras %}
    {% block title %}
{{ title }}
{% endblock %}

{% block content %}

     <div class="col">
              <a href="/orders" class="btn btn-primary {% if isOrdersTab %} active {% endif %}" aria-current="page">Замовлення {% if cartCountData.orders_incomplete > 0 %} <span class="badge bg-warning ms-2">{{ cartCountData.orders_incomplete }}</span> {% endif %}</a>
    {% if request.user|has_group:"empl" or request.user.is_staff %}
         <a href="{% url 'agreements' %}" class="btn btn-primary {% if isAgreementsTab %} active {% endif %}" aria-current="page">Договори</a>
     {% endif %}
  <a href="/preorders" class="btn btn-primary {% if isPreordersTab %} active {% endif %}">Передзамовлення {% if cartCountData.preorders_incomplete > 0 %} <span class="badge ms-2" style="background: #5bc0de">{{ cartCountData.preorders_incomplete }}</span> {% endif %}</a>

    {% if messages %}
<ul class="messages my-4" style="color: red">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}

</ul>
             <div id="error"></div>
{% endif %}

    </div>

{% if orders.count == 0 %}

    <h3>Передзамовлень ще немає!</h3>
{% else %}
    <div class="listOrders my-4">
    {% for order in orders %}

<div class="hstack gap-3 py-2">

 <a href="{% url 'preorderDetail' order.id %}?next={{ request.get_full_path }}" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true" style="border-radius: 1rem;">
    <div class="d-flex gap-2 w-100 justify-content-between">
      <div>
        <h6 class="mb-1">Заказ №: {{order.id}}</h6>
        <p class="mb-1">Для: {{order.place.name}}, {{order.place.city_ref.name}}</p>

        {% if order.isComplete %}
        <p class="mb-2"><span>Статус:</span> <span class="complete">Підтверджено</span></p>
        {% else %}
        <p class="mb-2"><span>Статус:</span> <span style="color: #5bc0de; font-weight: bold">В очікуванні</span></p>
        {% endif %}

        {% if order.comment %}
            <p class="mb-0"> <span class="text-muted">Комментарiй:</span> {{order.comment}}</p>
        {% endif %}

      </div>
      <div>
          {% if order.isComplete %}
      <p class="opacity-60 text-nowrap date">Дата відправки: {{order.dateSent|date:"d.m.Y"}}</p>
          {% endif %}
      <p class="opacity-60 text-nowrap date">Дата створення: {{order.dateCreated|date:"d.m.Y"}}</p>
      </div>

    </div>
  </a>

{% if not order.isComplete %}

<button data-product="{{ order.id }}" data-action="update-preorder" class="btn btn-success btn-lg add-btn update-order-status" type="submit"><i class="bi bi-check2"></i></button>
    {% else %}
    <a href="{% url 'preorderDetail-generate-order' order.id %}?next={{ request.get_full_path }}" class="btn btn-primary btn-lg" role="button" data-toggle="tooltip" data-placement="top" title="Згенерувати замовлення"><i class="bi bi-cart-plus-fill"></i></a>
{% endif %}
    <form action="" onsubmit="window.mytest()">
        <button data-product="{{ order.id }}" data-action="delete-preorder" class="btn btn-danger btn-lg add-btn update-order-status" type="submit"><i class="bi bi-trash"></i></button>
    </form>

  </div>

    {% endfor %}
    </div>
{% endif %}
<script type="text/javascript">window.mytest = function() { var isValid = confirm('Ви хочете видалити запис ?');if (!isValid) { event.preventDefault();  alert("It wont delete. Yay!");}}</script>
{% endblock %}